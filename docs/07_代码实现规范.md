# Phase 6: 代码实现规范与接口约定

> **Project:** Intelligent Cross-Domain Scheduling for Large Model Training (Task 3)
> **Target:** CCF-A Class Conference (System/AI Track)
> **Version:** v1.0
> **Date:** 2026-01-26

**核心假设**: 同构算力环境（各域 GPU 型号相同），核心挑战聚焦于**跨域网络动态性**与**通信优化**。

---

## 1. 目录结构规范

```
智能算力跨域调度研究/
├── docs/
├── src/
│   ├── envs/
│   ├── algorithms/
│   ├── utils/
│   └── configs/
├── experiments/
└── results/
```

---

## 2. 代码规范

- Python 3.10+，类型标注优先
- 核心算法逻辑必须可复现（固定随机种子）
- 所有实验参数必须可配置（YAML/JSON）
- 关键函数必须包含 docstring（输入、输出、假设）

---

## 3. 接口约定

### 3.1 环境接口 (Gym)

```python
class CrossDomainEnv(gym.Env):
    def reset(self): ...
    def step(self, action): ...
```

### 3.2 上层 Agent 接口

```python
class GlobalAgent:
    def select_action(self, s_high): ...
    def update(self, batch): ...
```

### 3.3 下层 Agent 接口

```python
class LocalAgent:
    def select_action(self, s_low): ...
    def update(self, batch): ...
```

---

## 4. 日志与指标规范

- 训练周期、通信成本、利用率写入统一日志
- 实验输出统一格式：CSV + JSON
- 必须记录环境配置、随机种子、模型版本

---

## 5. 配置文件规范

```
configs/
  env/
    network.yaml
    workload.yaml
  algo/
    hi_ppo.yaml
  astra_v2/                 # Astra-sim 2.0 生成配置
    network_config.yml
    system_config.json
    remote_memory.json
    workload/
      trace.{rank}.et
```

---

## 6. 测试规范

- 单元测试覆盖：拓扑编码、奖励计算、约束 mask
- 端到端测试：小规模 2-3 域场景

---

*本文件为代码实现的一致性规范*
